---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import { readFile } from 'fs/promises';
import { join } from 'path';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const allPosts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Ìè¨Ïä§Ìä∏ Î≥∏Î¨∏ ÎÇ¥Ïö© Ï∂îÏ∂ú (Í≤ÄÏÉâÏö©)
const postsWithContent = await Promise.all(
	allPosts.map(async (post) => {
		let bodyText = '';
		try {
			// ÎßàÌÅ¨Îã§Ïö¥ ÌååÏùº Í≤ΩÎ°ú Íµ¨ÏÑ±
			const filePath = join(process.cwd(), 'src', 'content', 'blog', `${post.id}.md`);
			const fileContent = await readFile(filePath, 'utf-8');
			
			// frontmatter Ï†úÍ±∞ÌïòÍ≥† Î≥∏Î¨∏Îßå Ï∂îÏ∂ú
			const frontmatterEnd = fileContent.indexOf('---', 3);
			if (frontmatterEnd !== -1) {
				bodyText = fileContent.substring(frontmatterEnd + 3).trim();
				// ÎßàÌÅ¨Îã§Ïö¥ Î¨∏Î≤ï Ï†úÍ±∞ (Í∞ÑÎã®Ìïú Î≤ÑÏ†Ñ)
				bodyText = bodyText
					.replace(/^#+\s+/gm, '') // Ìó§Îçî Ï†úÍ±∞
					.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1') // ÎßÅÌÅ¨ Ï†úÍ±∞
					.replace(/!\[([^\]]*)\]\([^\)]+\)/g, '') // Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞
					.replace(/\*\*([^\*]+)\*\*/g, '$1') // Î≥ºÎìú Ï†úÍ±∞
					.replace(/\*([^\*]+)\*/g, '$1') // Ïù¥ÌÉ§Î¶≠ Ï†úÍ±∞
					.replace(/`([^`]+)`/g, '$1') // Ïù∏ÎùºÏù∏ ÏΩîÎìú Ï†úÍ±∞
					.replace(/```[\s\S]*?```/g, '') // ÏΩîÎìú Î∏îÎ°ù Ï†úÍ±∞
					.replace(/\n+/g, ' ') // Ï§ÑÎ∞îÍøàÏùÑ Í≥µÎ∞±ÏúºÎ°ú
					.trim()
					.substring(0, 1000); // ÏµúÎåÄ 1000Ïûê
			}
		} catch (e) {
			// ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå® Ïãú description ÏÇ¨Ïö©
			bodyText = post.data.description || '';
		}
		
		return {
			...post,
			bodyText: bodyText,
		};
	})
);

const featuredPost = postsWithContent[0];
const otherPosts = postsWithContent.slice(1); // ÎÇòÎ®∏ÏßÄ Î™®Îì† Ìè¨Ïä§Ìä∏

// ÌéòÏù¥Ïßï ÏÑ§Ï†ï
const POSTS_PER_PAGE = 10;

// Í≤ÄÏÉâÏö© Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ (Ï†úÎ™©, ÏÑ§Î™Ö, ÌÉúÍ∑∏, ÎÇ¥Ïö©)
const searchData = postsWithContent.map((post) => ({
	id: post.id,
	title: post.data.title,
	description: post.data.description,
	tags: post.data.tags || [],
	content: post.bodyText,
	heroImage: post.data.heroImage?.src || null,
	pubDate: post.data.pubDate.toISOString(),
}));

const totalPages = Math.ceil(otherPosts.length / POSTS_PER_PAGE);

---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Blog | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
		<style>
			main {
				max-width: 1400px;
				width: 100%;
				padding: 4em 2em;
			}
			.page-title {
				font-size: 3.5rem;
				font-weight: 700;
				margin-bottom: 0.5em;
				background: linear-gradient(135deg, rgb(var(--black)) 0%, var(--accent-glow) 100%);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
				text-align: center;
			}
			.posts-container {
				display: flex;
				flex-direction: column;
				gap: 2rem;
				list-style-type: none;
				margin: 3rem 0 0 0;
				padding: 0;
			}
			.posts-list {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 2rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			.post-item {
				opacity: 1;
				transform: translateY(0);
				transition: opacity 0.3s ease, transform 0.3s ease;
			}
			.post-item.hidden {
				display: none;
			}
			.search-section {
				grid-column: 1 / -1;
				margin: 2rem 0;
			}
			.search-form {
				display: flex;
				gap: 1rem;
				align-items: center;
				justify-content: center;
				flex-wrap: wrap;
			}
			.search-select {
				padding: 0.75rem 1rem;
				background: var(--card-bg);
				border: 1px solid var(--card-border);
				border-radius: 8px;
				color: rgb(var(--black));
				font-size: 0.95rem;
				cursor: pointer;
				transition: all 0.3s ease;
			}
			.search-select:focus {
				outline: none;
				border-color: var(--accent);
				box-shadow: var(--neon-glow);
			}
			.search-input {
				padding: 0.75rem 1rem;
				background: var(--card-bg);
				border: 1px solid var(--card-border);
				border-radius: 8px;
				color: rgb(var(--black));
				font-size: 0.95rem;
				width: 300px;
				transition: all 0.3s ease;
			}
			.search-input:focus {
				outline: none;
				border-color: var(--accent);
				box-shadow: var(--neon-glow);
			}
			.search-input::placeholder {
				color: rgb(var(--gray));
			}
			.search-button {
				padding: 0.75rem 2rem;
				background: var(--accent);
				border: 1px solid var(--accent);
				border-radius: 8px;
				color: rgb(var(--black));
				font-size: 0.95rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
			}
			.search-button:hover {
				background: var(--accent-glow);
				box-shadow: var(--neon-glow);
				transform: translateY(-2px);
			}
			.search-button:active {
				transform: translateY(0);
			}
			.no-results {
				grid-column: 1 / -1;
				text-align: center;
				padding: 4rem 2rem;
				color: rgb(var(--gray));
			}
			.no-results h3 {
				font-size: 1.5rem;
				margin-bottom: 0.5rem;
				color: rgb(var(--black));
			}
			.pagination {
				grid-column: 1 / -1;
				display: flex;
				justify-content: center;
				align-items: center;
				gap: 0.5rem;
				margin-top: 3rem;
				flex-wrap: wrap;
			}
			@media (max-width: 720px) {
				.search-form {
					flex-direction: column;
					gap: 0.75rem;
				}
				.search-select,
				.search-input {
					width: 100%;
				}
				.search-button {
					width: 100%;
				}
			}
			.pagination-button {
				padding: 0.75rem 1.25rem;
				background: var(--card-bg);
				border: 1px solid var(--card-border);
				border-radius: 8px;
				color: rgb(var(--gray-dark));
				text-decoration: none;
				transition: all 0.3s ease;
				font-size: 0.95rem;
				cursor: pointer;
			}
			.pagination-button:hover:not(.disabled):not(.active) {
				border-color: var(--accent);
				color: var(--accent);
				background: rgba(79, 140, 255, 0.1);
			}
			.pagination-button.active {
				background: var(--accent);
				border-color: var(--accent);
				color: rgb(var(--black));
				box-shadow: var(--neon-glow);
			}
			.pagination-button.disabled {
				opacity: 0.5;
				cursor: not-allowed;
				pointer-events: none;
			}
			.post-card {
				display: flex;
				flex-direction: row;
				background: var(--card-bg);
				border: 1px solid var(--card-border);
				border-radius: 16px;
				overflow: hidden;
				transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
				text-decoration: none;
				position: relative;
			}
			.post-card::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: linear-gradient(135deg, rgba(79, 140, 255, 0.1) 0%, transparent 100%);
				opacity: 0;
				transition: opacity 0.4s ease;
				pointer-events: none;
			}
			.post-card:hover {
				transform: translateY(-8px);
				border-color: var(--accent);
				box-shadow: var(--neon-glow), 0 20px 40px rgba(0, 0, 0, 0.4);
			}
			.post-card:hover::before {
				opacity: 1;
			}
			.featured-card {
				flex-direction: row;
			}
			.post-image-wrapper {
				width: 40%;
				flex-shrink: 0;
				overflow: hidden;
			}
			.featured-card .post-image-wrapper {
				width: 50%;
			}
			.post-image {
				width: 100%;
				height: 100%;
				min-height: 200px;
				object-fit: cover;
				display: block;
				transition: transform 0.4s ease;
			}
			.featured-card .post-image {
				min-height: 350px;
			}
			.post-card:hover .post-image {
				transform: scale(1.05);
			}
			.post-content {
				padding: 1.5rem;
				display: flex;
				flex-direction: column;
				flex: 1;
				justify-content: center;
			}
			.featured-card .post-content {
				padding: 2.5rem;
			}
			.post-title {
				margin: 0 0 0.75rem 0;
				color: rgb(var(--black));
				line-height: 1.3;
				font-size: 1.2rem;
				font-weight: 600;
				transition: color 0.3s ease;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
				word-break: keep-all;
			}
			.featured-card .post-title {
				font-size: 1.8rem;
				-webkit-line-clamp: 2;
				margin-bottom: 1rem;
			}
			.post-card:hover .post-title {
				color: var(--accent-glow);
			}
			.post-date {
				margin: 0 0 0.75rem 0;
				color: rgb(var(--gray));
				font-size: 0.85rem;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}
			.post-date::before {
				content: 'üìÖ';
				font-size: 1rem;
			}
			.post-tags {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				margin-top: auto;
				padding-top: 0.5rem;
			}
			.post-tag {
				display: inline-block;
				padding: 0.4rem 0.8rem;
				background: rgba(79, 140, 255, 0.1);
				border: 1px solid var(--card-border);
				border-radius: 6px;
				color: var(--accent);
				font-size: 0.85rem;
				transition: all 0.3s ease;
			}
			.post-card:hover .post-tag {
				background: rgba(79, 140, 255, 0.2);
				border-color: var(--accent);
			}
			@media (max-width: 1024px) {
				.posts-list {
					grid-template-columns: 1fr;
				}
				.featured-card,
				.post-card {
					flex-direction: column;
				}
				.post-image-wrapper,
				.featured-card .post-image-wrapper {
					width: 100%;
				}
				.post-image,
				.featured-card .post-image {
					min-height: 250px;
				}
			}
			@media (max-width: 720px) {
				main {
					padding: 2em 1em;
				}
				.page-title {
					font-size: 2.5rem;
				}
				.posts-container {
					gap: 1.5rem;
				}
				.posts-list {
					grid-template-columns: 1fr;
					gap: 1.5rem;
				}
				.featured-card .post-content {
					padding: 1.5rem;
				}
				.featured-card .post-title {
					font-size: 1.4rem;
				}
				.post-content {
					padding: 1.25rem;
				}
				.post-title {
					font-size: 1.1rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1 class="page-title">Blog Posts</h1>
			<ul class="posts-container">
				{featuredPost && (
					<li>
						<a href={`/blog/${featuredPost.id}/`} class="post-card featured-card">
							{featuredPost.data.heroImage && (
								<div class="post-image-wrapper">
									<Image
										width={720}
										height={360}
										src={featuredPost.data.heroImage}
										alt=""
										class="post-image"
									/>
								</div>
							)}
							<div class="post-content">
								<h2 class="post-title">{featuredPost.data.title}</h2>
								<p class="post-date">
									<FormattedDate date={featuredPost.data.pubDate} />
								</p>
								{featuredPost.data.tags && featuredPost.data.tags.length > 0 && (
									<div class="post-tags">
										{featuredPost.data.tags.slice(0, 3).map((tag) => (
											<span class="post-tag">{tag}</span>
										))}
									</div>
								)}
							</div>
						</a>
					</li>
				)}
				{otherPosts.length > 0 && (
					<>
						<ul class="posts-list" id="posts-list">
							{
								otherPosts.map((post, index) => (
									<li class="post-item" data-index={index} data-post-id={post.id}>
										<a href={`/blog/${post.id}/`} class="post-card">
											{post.data.heroImage && (
												<div class="post-image-wrapper">
													<Image
														width={720}
														height={360}
														src={post.data.heroImage}
														alt=""
														class="post-image"
													/>
												</div>
											)}
											<div class="post-content">
												<h2 class="post-title">{post.data.title}</h2>
												<p class="post-date">
													<FormattedDate date={post.data.pubDate} />
												</p>
												{post.data.tags && post.data.tags.length > 0 && (
													<div class="post-tags">
														{post.data.tags.slice(0, 3).map((tag) => (
															<span class="post-tag">{tag}</span>
														))}
													</div>
												)}
											</div>
										</a>
									</li>
								))
							}
							<li class="no-results" id="no-results" style="display: none;">
								<h3>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
								<p>Îã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî.</p>
							</li>
						</ul>
						<div class="search-section">
							<form class="search-form" id="search-form">
								<select class="search-select" id="search-type" aria-label="Í≤ÄÏÉâ Ïú†Ìòï">
									<option value="all">Ï†ÑÏ≤¥</option>
									<option value="title">Ï†úÎ™©</option>
									<option value="content">ÎÇ¥Ïö©</option>
									<option value="tags">ÌÉúÍ∑∏</option>
								</select>
								<input
									type="text"
									class="search-input"
									id="search-input"
									placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
									aria-label="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•"
								/>
								<button type="submit" class="search-button">Í≤ÄÏÉâ</button>
							</form>
						</div>
						{totalPages > 1 && (
							<div class="pagination" id="pagination">
								<button class="pagination-button" id="prev-button" data-page="1">Ïù¥Ï†Ñ</button>
								{
									Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
										<button class="pagination-button" data-page={pageNum}>
											{pageNum}
										</button>
									))
								}
								<button class="pagination-button" id="next-button" data-page="2">Îã§Ïùå</button>
							</div>
						)}
					</>
				)}
			</ul>
		</main>
		<Footer />
		<script define:vars={{ searchData, postsPerPage: POSTS_PER_PAGE, totalPages, otherPostsCount: otherPosts.length }}>
			(function() {
				const postsList = document.getElementById('posts-list');
				const pagination = document.getElementById('pagination');
				const searchForm = document.getElementById('search-form');
				const searchInput = document.getElementById('search-input');
				const searchType = document.getElementById('search-type');
				let postItems = Array.from(document.querySelectorAll('.post-item'));
				
				if (!postsList || postItems.length === 0) return;
				
				let filteredPosts = postItems; // ÌïÑÌÑ∞ÎßÅÎêú Ìè¨Ïä§Ìä∏ Î™©Î°ù
				let currentSearchQuery = '';
				let currentSearchType = 'all';
				
				// URLÏóêÏÑú ÌéòÏù¥ÏßÄ Î≤àÌò∏ÏôÄ Í≤ÄÏÉâ ÏøºÎ¶¨ Í∞ÄÏ†∏Ïò§Í∏∞
				const urlParams = new URLSearchParams(window.location.search);
				let currentPage = parseInt(urlParams.get('page')) || 1;
				const urlSearchQuery = urlParams.get('q') || '';
				const urlSearchType = urlParams.get('type') || 'all';
				
				if (urlSearchQuery) {
					searchInput.value = urlSearchQuery;
					searchType.value = urlSearchType;
					currentSearchQuery = urlSearchQuery;
					currentSearchType = urlSearchType;
				}
				
				if (currentPage < 1) currentPage = 1;
				
				// Í≤ÄÏÉâ Ìï®Ïàò
				function performSearch(query, type) {
					currentSearchQuery = query.toLowerCase().trim();
					currentSearchType = type;
					const noResults = document.getElementById('no-results');
					
					if (!currentSearchQuery) {
						// Í≤ÄÏÉâÏñ¥Í∞Ä ÏóÜÏúºÎ©¥ Î™®Îì† Ìè¨Ïä§Ìä∏ ÌëúÏãú
						filteredPosts = postItems;
						if (noResults) noResults.style.display = 'none';
					} else {
						// Í≤ÄÏÉâ Ïã§Ìñâ
						filteredPosts = postItems.filter((item) => {
							const postId = item.getAttribute('data-post-id');
							const post = searchData.find(p => p.id === postId);
							if (!post) return false;
							
							const searchTerm = currentSearchQuery;
							
							if (type === 'title') {
								return post.title.toLowerCase().includes(searchTerm);
							} else if (type === 'content') {
								return post.content.toLowerCase().includes(searchTerm);
							} else if (type === 'tags') {
								return post.tags.some(tag => tag.toLowerCase().includes(searchTerm));
							} else { // all
								return (
									post.title.toLowerCase().includes(searchTerm) ||
									post.description.toLowerCase().includes(searchTerm) ||
									post.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
									post.content.toLowerCase().includes(searchTerm)
								);
							}
						});
						
						// Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå Î©îÏãúÏßÄ
						if (noResults) {
							if (filteredPosts.length === 0) {
								noResults.style.display = 'block';
							} else {
								noResults.style.display = 'none';
							}
						}
					}
					
					// Í≤ÄÏÉâ Í≤∞Í≥ºÏóê Îî∞Îùº ÌéòÏù¥ÏßÄ Î¶¨ÏÖã
					currentPage = 1;
					const filteredPages = Math.ceil(filteredPosts.length / postsPerPage);
					updatePagination();
					// DOM ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å ÌõÑ ÌéòÏù¥ÏßÄ ÌëúÏãú Î∞è Î≤ÑÌäº Ïä§ÌÉÄÏùº Ï†ÅÏö©
					setTimeout(() => {
						showPage(1, filteredPages);
					}, 0);
				}
				
				// ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÏóÖÎç∞Ïù¥Ìä∏ (ÌïÑÌÑ∞ÎßÅÎêú Í≤∞Í≥ºÏóê Îî∞Îùº)
				function updatePagination() {
					const filteredPages = Math.ceil(filteredPosts.length / postsPerPage);
					const paginationElement = document.getElementById('pagination');
					
					if (!paginationElement) return;
					
					// Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞Î•º ÏúÑÌï¥ ÏÉà ÏöîÏÜåÎ°ú ÍµêÏ≤¥
					const newPaginationContainer = document.createElement('div');
					newPaginationContainer.className = 'pagination';
					newPaginationContainer.id = 'pagination';
					
					if (filteredPages > 1) {
						// Ïù¥Ï†Ñ Î≤ÑÌäº
						const prevButton = document.createElement('button');
						prevButton.className = 'pagination-button';
						prevButton.id = 'prev-button';
						prevButton.textContent = 'Ïù¥Ï†Ñ';
						prevButton.dataset.page = '1';
						newPaginationContainer.appendChild(prevButton);
						
						// ÌéòÏù¥ÏßÄ Î≤àÌò∏ Î≤ÑÌäºÎì§
						for (let i = 1; i <= filteredPages; i++) {
							const pageButton = document.createElement('button');
							pageButton.className = 'pagination-button';
							pageButton.textContent = i;
							pageButton.dataset.page = i;
							newPaginationContainer.appendChild(pageButton);
						}
						
						// Îã§Ïùå Î≤ÑÌäº
						const nextButton = document.createElement('button');
						nextButton.className = 'pagination-button';
						nextButton.id = 'next-button';
						nextButton.textContent = 'Îã§Ïùå';
						nextButton.dataset.page = '2';
						newPaginationContainer.appendChild(nextButton);
						
						// Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
						newPaginationContainer.addEventListener('click', handlePaginationClick);
					}
					
					// Í∏∞Ï°¥ ÏöîÏÜå ÍµêÏ≤¥
					paginationElement.parentNode.replaceChild(newPaginationContainer, paginationElement);
					
					// DOM ÍµêÏ≤¥ ÌõÑ Ï¶âÏãú Ïä§ÌÉÄÏùº Ï†ÅÏö©ÏùÑ ÏúÑÌï¥ Îã§Ïùå ÌîÑÎ†àÏûÑÏóêÏÑú Ï≤òÎ¶¨
					return filteredPages;
				}
				
				// ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÌëúÏãú Ìï®Ïàò
				function showPage(page, totalPagesCount) {
					if (!totalPagesCount) {
						totalPagesCount = Math.ceil(filteredPosts.length / postsPerPage);
					}
					
					if (page < 1) page = 1;
					if (page > totalPagesCount) page = totalPagesCount;
					
					currentPage = page;
					
					const startIndex = (page - 1) * postsPerPage;
					const endIndex = startIndex + postsPerPage;
					
					// Î™®Îì† Ìè¨Ïä§Ìä∏ Ïà®Í∏∞Í∏∞
					postItems.forEach(item => {
						item.classList.add('hidden');
					});
					
					// ÌïÑÌÑ∞ÎßÅÎêú Ìè¨Ïä§Ìä∏ Ï§ë ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Ìï≠Î™©Îßå ÌëúÏãú
					filteredPosts.forEach((item, index) => {
						if (index >= startIndex && index < endIndex) {
							item.classList.remove('hidden');
						}
					});
					
					// ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏ (ÏßÅÏ†ë Ìò∏Ï∂ú)
					updatePaginationButtons(page, totalPagesCount);
					
					// URL ÏóÖÎç∞Ïù¥Ìä∏
					const params = new URLSearchParams();
					if (page > 1) params.set('page', page);
					if (currentSearchQuery) {
						params.set('q', currentSearchQuery);
						if (currentSearchType !== 'all') {
							params.set('type', currentSearchType);
						}
					}
					const queryString = params.toString();
					const newUrl = queryString 
						? `${window.location.pathname}?${queryString}` 
						: window.location.pathname;
					window.history.replaceState({}, '', newUrl);
				}
				
				// ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
				function updatePaginationButtons(page, totalPagesCount) {
					const paginationElement = document.getElementById('pagination');
					if (!paginationElement) {
						// DOMÏù¥ ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑ
						setTimeout(() => updatePaginationButtons(page, totalPagesCount), 10);
						return;
					}
					
					const prevButton = document.getElementById('prev-button');
					const nextButton = document.getElementById('next-button');
					
					// Î≤ÑÌäºÏù¥ ÏóÜÏúºÎ©¥ Î∞òÌôò (ÌïÑÌÑ∞ÎßÅÎêú ÌéòÏù¥ÏßÄÍ∞Ä 1Í∞ú Ïù¥ÌïòÏùº Îïå)
					if (!prevButton || !nextButton) return;
					
					// Î™®Îì† Ïà´Ïûê Î≤ÑÌäºÏóêÏÑú active Ï†úÍ±∞ (Ïù¥Ï†Ñ/Îã§Ïùå Î≤ÑÌäº Ï†úÏô∏)
					const numberButtons = paginationElement.querySelectorAll('.pagination-button:not(#prev-button):not(#next-button)');
					numberButtons.forEach(btn => {
						btn.classList.remove('active');
					});
					
					// ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌôúÏÑ±Ìôî (Ïà´Ïûê Î≤ÑÌäºÎßå)
					numberButtons.forEach(btn => {
						const btnPage = parseInt(btn.dataset.page);
						if (btnPage === page) {
							btn.classList.add('active');
						}
					});
					
					// Ïù¥Ï†Ñ/Îã§Ïùå Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
					prevButton.classList.remove('active', 'disabled');
					if (page === 1) {
						prevButton.classList.add('disabled');
					} else {
						prevButton.dataset.page = page - 1;
					}
					
					nextButton.classList.remove('active', 'disabled');
					if (page >= totalPagesCount) {
						nextButton.classList.add('disabled');
					} else {
						nextButton.dataset.page = page + 1;
					}
				}
				
				// ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
				function handlePaginationClick(e) {
					e.stopPropagation();
					const button = e.target.closest('.pagination-button');
					if (!button || button.classList.contains('disabled')) return;
					
					const page = parseInt(button.dataset.page);
					const filteredPages = Math.ceil(filteredPosts.length / postsPerPage);
					if (page && page >= 1 && page <= filteredPages) {
						showPage(page, filteredPages);
						// ÌéòÏù¥ÏßÄ ÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§
						window.scrollTo({ top: 0, behavior: 'smooth' });
					}
				}
				
				// Í≤ÄÏÉâ Ìèº Ïù¥Î≤§Ìä∏
				if (searchForm) {
					searchForm.addEventListener('submit', (e) => {
						e.preventDefault();
						const query = searchInput.value.trim();
						const type = searchType.value;
						performSearch(query, type);
						window.scrollTo({ top: 0, behavior: 'smooth' });
					});
				}
				
				// Ï¥àÍ∏∞Ìôî
				if (urlSearchQuery) {
					performSearch(urlSearchQuery, urlSearchType);
				} else {
					// Í≤ÄÏÉâÏñ¥Í∞Ä ÏóÜÏúºÎ©¥ Î™®Îì† Ìè¨Ïä§Ìä∏ ÏÇ¨Ïö©
					filteredPosts = postItems;
					const filteredPages = Math.ceil(filteredPosts.length / postsPerPage);
					
					// ÌéòÏù¥Ïßï ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ï¥àÍ∏∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
					const initialPagination = document.getElementById('pagination');
					if (initialPagination && filteredPages > 1) {
						initialPagination.addEventListener('click', handlePaginationClick);
						updatePaginationButtons(currentPage, filteredPages);
					}
					
					showPage(currentPage, filteredPages);
				}
			})();
		</script>
	</body>
</html>
